<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Chart with D3.js</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: white;
      margin: 0;
      padding: 0;
    }
    .chart-container {
      width: 90%;
      max-width: 800px;
      margin: 40px auto;
    }
    .tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
    }
    .range-selector {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .range-selector button {
      background-color: #333;
      border: none;
      color: white;
      padding: 10px 15px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 4px;
    }
    .range-selector button:hover {
      background-color: #555;
    }
    .range-selector button.active {
      background-color: #007acc;
    }
  </style>
</head>
<body>
  <div class="chart-container">
    <div class="range-selector">
      <button data-range="1D">1D</button>
      <button data-range="5D">5D</button>
      <button data-range="1M">1M</button>
      <button data-range="6M" class="active">6M</button>
      <button data-range="1Y">1Y</button>
      <button data-range="Max">Max</button>
    </div>
    <svg id="chart" width="800" height="400"></svg>
  </div>
  <div class="tooltip" id="tooltip" style="display: none;"></div>

  <script>
    const data = [
      { date: '2024-10-01', close: 1464.9 },
      { date: '2024-10-03', close: 1407.62 },
      { date: '2024-10-07', close: 1370.47 },
      { date: '2024-11-01', close: 1339.1 },
      { date: '2024-12-01', close: 1300.1 },
      { date: '2025-01-01', close: 1221.65 },
      { date: '2025-02-01', close: 1264.65 }
    ];

    const parseDate = d3.timeParse('%Y-%m-%d');
    const formatDate = d3.timeFormat('%b %d, %Y');

    data.forEach(d => {
      d.date = parseDate(d.date);
      d.close = +d.close;
    });

    const margin = { top: 20, right: 20, bottom: 30, left: 50 },
      width = 800 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    const svg = d3
      .select('#chart')
      .append('g')
      .attr('transform', `translate(${margin.left},${margin.top})`);

    const x = d3
      .scaleTime()
      .domain(d3.extent(data, d => d.date))
      .range([0, width]);

    const y = d3
      .scaleLinear()
      .domain([d3.min(data, d => d.close) * 0.9, d3.max(data, d => d.close) * 1.1])
      .range([height, 0]);

    const xAxis = d3.axisBottom(x);
    const yAxis = d3.axisLeft(y);

    svg
      .append('g')
      .attr('transform', `translate(0,${height})`)
      .attr('class', 'x-axis')
      .call(xAxis);

    svg.append('g').attr('class', 'y-axis').call(yAxis);

    const line = d3
      .line()
      .x(d => x(d.date))
      .y(d => y(d.close))
      .curve(d3.curveMonotoneX);

    svg
      .append('path')
      .datum(data)
      .attr('class', 'line')
      .attr('fill', 'none')
      .attr('stroke', '#007acc')
      .attr('stroke-width', 2)
      .attr('d', line);

    const tooltip = d3.select('#tooltip');

    svg
      .selectAll('.dot')
      .data(data)
      .enter()
      .append('circle')
      .attr('class', 'dot')
      .attr('cx', d => x(d.date))
      .attr('cy', d => y(d.close))
      .attr('r', 5)
      .attr('fill', '#007acc')
      .on('mouseover', function (event, d) {
        tooltip
          .style('display', 'block')
          .style('left', event.pageX + 10 + 'px')
          .style('top', event.pageY - 20 + 'px')
          .html(`Date: ${formatDate(d.date)}<br>Close: ${d.close}`);
        d3.select(this).attr('r', 7);
      })
      .on('mouseout', function () {
        tooltip.style('display', 'none');
        d3.select(this).attr('r', 5);
      });

    // Range selector logic
    d3.selectAll('.range-selector button').on('click', function () {
      const range = d3.select(this).attr('data-range');
      d3.selectAll('.range-selector button').classed('active', false);
      d3.select(this).classed('active', true);

      // Dummy range filtering for demonstration
      const filteredData = range === '6M' ? data.slice(2, 6) : data;

      // Update scales
      x.domain(d3.extent(filteredData, d => d.date));
      y.domain([d3.min(filteredData, d => d.close) * 0.9, d3.max(filteredData, d => d.close) * 1.1]);

      // Update axes
      svg.select('.x-axis').call(xAxis);
      svg.select('.y-axis').call(yAxis);

      // Update line
      svg.select('.line').datum(filteredData).attr('d', line);

      // Update dots
      const dots = svg.selectAll('.dot').data(filteredData, d => d.date);

      dots
        .enter()
        .append('circle')
        .attr('class', 'dot')
        .attr('r', 5)
        .attr('fill', '#007acc')
        .merge(dots)
        .attr('cx', d => x(d.date))
        .attr('cy', d => y(d.close))
        .on('mouseover', function (event, d) {
          tooltip
            .style('display', 'block')
            .style('left', event.pageX + 10 + 'px')
            .style('top', event.pageY - 20 + 'px')
            .html(`Date: ${formatDate(d.date)}<br>Close: ${d.close}`);
          d3.select(this).attr('r', 7);
        })
        .on('mouseout', function () {
          tooltip.style('display', 'none');
          d3.select(this).attr('r', 5);
        });

      dots.exit().remove();
    });
  </script>
</body>
</html>
